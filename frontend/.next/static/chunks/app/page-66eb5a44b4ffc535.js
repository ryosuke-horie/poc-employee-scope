(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1089:(e,t,s)=>{"use strict";s.d(t,{P:()=>m});var a=s(9915),l=s.n(a),r=s(1527),n=s.n(r);let i=null,c=null,o=null,d=async()=>{if(!c)return o||(o=(async()=>{i=new(l())({allErrors:!0,strict:!1}),n()(i);try{let e=await fetch("/schemas/review.schema.json");if(!e.ok)throw Error("Failed to fetch schema: ".concat(e.status));let t=await e.json();c=i.compile(t)}catch(e){throw console.error("Failed to load schema:",e),Error("スキーマの読み込みに失敗しました")}})())},m=async e=>{if(await d(),!c)throw Error("バリデータが初期化されていません");let t=c(e);return{valid:t,errors:t?void 0:c.errors||[]}}},2951:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(5155),l=s(2115),r=s(6874),n=s.n(r);function i(e){let{companies:t,reviewData:s,onUpdateReview:l}=e;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-2",children:["企業一覧 (",t.length,"社)"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["判定済み: ",t.filter(e=>{var t;return null==(t=e.reviewState)?void 0:t.decision}).length,"社 / 未判定: ",t.filter(e=>{var t;return!(null==(t=e.reviewState)?void 0:t.decision)}).length,"社"]})]}),t.map(e=>{var t,s,r,i;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["証跡: ",e.evidences.length,"件"]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat((e=>{switch(e){case"ok":return"bg-green-100 text-green-800";case"ng":return"bg-red-100 text-red-800";case"unknown":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}})(null==(t=e.reviewState)?void 0:t.decision)),children:(e=>{switch(e){case"ok":return"OK";case"ng":return"NG";case"unknown":return"不明";default:return"未判定"}})(null==(s=e.reviewState)?void 0:s.decision)})})]}),e.bestEvidence&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("span",{className:"font-medium",children:"抽出値:"})," ",e.bestEvidence.value,"人"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"信頼度:"})," ",(100*(e.bestEvidence.score||0)).toFixed(0),"%"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"抽出方法:"})," ",e.bestEvidence.model]})]}),(null==(r=e.reviewState)?void 0:r.override_value)&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-50 rounded",children:(0,a.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,a.jsx)("span",{className:"font-medium",children:"上書き値:"})," ",e.reviewState.override_value,"人"]})}),(null==(i=e.reviewState)?void 0:i.note)&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 rounded",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("span",{className:"font-medium",children:"メモ:"})," ",e.reviewState.note]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n(),{href:"/company/".concat(e.id),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"詳細を見る"}),(0,a.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,a.jsx)("button",{onClick:()=>l(e.id,{company_id:e.id,decision:"ok",decided_at:new Date().toISOString()}),className:"px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"OK"}),(0,a.jsx)("button",{onClick:()=>l(e.id,{company_id:e.id,decision:"ng",decided_at:new Date().toISOString()}),className:"px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",children:"NG"}),(0,a.jsx)("button",{onClick:()=>l(e.id,{company_id:e.id,decision:"unknown",decided_at:new Date().toISOString()}),className:"px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"不明"})]})]})]})},e.id)})]})}function c(e){let{companies:t,onFilter:s,reviewData:r}=e,[n,i]=(0,l.useState)(["ok","ng","unknown","none"]),[c,o]=(0,l.useState)(0),[d,m]=(0,l.useState)(1);return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"フィルタ"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"判定状態"}),(0,a.jsx)("div",{className:"space-y-2",children:[{value:"ok",label:"OK"},{value:"ng",label:"NG"},{value:"unknown",label:"不明"},{value:"none",label:"未判定"}].map(e=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:n.includes(e.value),onChange:()=>{var t;return t=e.value,void i(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:e.label})]},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"信頼度スコア"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-xs text-gray-600",children:["最小: ",(100*c).toFixed(0),"%"]}),(0,a.jsx)("input",{type:"range",min:"0",max:"100",value:100*c,onChange:e=>o(parseInt(e.target.value)/100),className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-xs text-gray-600",children:["最大: ",(100*d).toFixed(0),"%"]}),(0,a.jsx)("input",{type:"range",min:"0",max:"100",value:100*d,onChange:e=>m(parseInt(e.target.value)/100),className:"w-full"})]})]})]}),(0,a.jsx)("button",{onClick:()=>{s(r.companies.map(e=>{let t=r.evidence.filter(t=>t.company_id===e.id),s=r.review_state.find(t=>t.company_id===e.id),a=t.filter(e=>null!==e.value).sort((e,t)=>(t.score||0)-(e.score||0))[0];return{...e,evidences:t,reviewState:s,bestEvidence:a}}).filter(e=>{var t;let s=(null==(t=e.reviewState)?void 0:t.decision)||"none";if(!n.includes("none"===s?"none":s))return!1;if(e.bestEvidence){let t=e.bestEvidence.score||0;if(t<c||t>d)return!1}return!0}))},className:"w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"フィルタを適用"})]})]})}function o(e){let{reviewData:t,onSave:s,onImport:r}=e,n=(0,l.useRef)(null);return(0,a.jsx)("div",{className:"bg-white border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("button",{onClick:()=>s(t),className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V2"})}),"JSONを保存"]}),(0,a.jsxs)("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"JSONをインポート"]}),(0,a.jsx)("input",{ref:n,type:"file",accept:".json",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];s&&r(s)},className:"hidden"}),(0,a.jsxs)("button",{onClick:()=>{let e=[["company_id","company_name","decision","override_value","final_value","note","decided_at"]];t.companies.forEach(s=>{var a,l,r;let n=t.review_state.find(e=>e.company_id===s.id),i=t.evidence.filter(e=>e.company_id===s.id).filter(e=>null!==e.value).sort((e,t)=>(t.score||0)-(e.score||0))[0],c=null!=(r=null!=(l=null==n?void 0:n.override_value)?l:null==i?void 0:i.value)?r:"";e.push([s.id.toString(),s.name,(null==n?void 0:n.decision)||"",(null==n||null==(a=n.override_value)?void 0:a.toString())||"",c.toString(),(null==n?void 0:n.note)||"",(null==n?void 0:n.decided_at)||""])});let s=new Blob([e.map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="review_export_".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)},className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"CSVエクスポート"]}),(0,a.jsxs)("div",{className:"ml-auto text-sm text-gray-600",children:["総企業数: ",t.companies.length," / 総証跡数: ",t.evidence.length]})]})})})}var d=s(6349),m=s(1089);function x(){let[e,t]=(0,l.useState)(null),[s,r]=(0,l.useState)([]),[n,x]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[v,p]=(0,l.useState)([]);(0,l.useEffect)(()=>{g()},[]);let g=async()=>{try{x(!0),h(null);let e=await fetch("/review.json");if(!e.ok)throw Error("Failed to load review.json: ".concat(e.status));let s=await e.json(),a=await (0,m.P)(s);if(!a.valid){p(a.errors||[]),console.error("Schema validation errors:",a.errors);return}p([]),t(s);let l=j(s);r(l)}catch(e){console.error("Error loading review data:",e),h(e instanceof Error?e.message:"Failed to load review data")}finally{x(!1)}},j=e=>e.companies.map(t=>{let s=e.evidence.filter(e=>e.company_id===t.id),a=e.review_state.find(e=>e.company_id===t.id),l=s.filter(e=>null!==e.value).sort((e,t)=>(t.score||0)-(e.score||0))[0];return{...t,evidences:s,reviewState:a,bestEvidence:l}}),b=async e=>{let t=await (0,m.P)(e);if(!t.valid){p(t.errors||[]),console.error("Schema validation errors before save:",t.errors);return}p([]);try{localStorage.setItem("review_state_v1",JSON.stringify(e)),console.log("Data saved to localStorage")}catch(e){console.error("Failed to save to localStorage:",e),h("Failed to save data")}let s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="review_".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)};return n?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xl",children:"データを読み込み中..."})}):u?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"max-w-md text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"エラー"}),(0,a.jsx)("p",{className:"mb-4",children:u}),(0,a.jsx)("button",{onClick:g,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"再読み込み"})]})}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[v.length>0&&(0,a.jsx)(d.A,{errors:v}),(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"従業員数レビューシステム"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["生成日時: ",new Date(e.generated_at).toLocaleString("ja-JP")]})]})}),(0,a.jsx)(o,{reviewData:e,onSave:b,onImport:e=>{let s=new FileReader;s.onload=async e=>{try{var s;let a=JSON.parse(null==(s=e.target)?void 0:s.result),l=await (0,m.P)(a);if(!l.valid){p(l.errors||[]),console.error("Schema validation errors on import:",l.errors);return}p([]),t(a);let n=j(a);r(n)}catch(e){h("Invalid JSON file")}},s.readAsText(e)}}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)(c,{companies:s,onFilter:r,reviewData:e})}),(0,a.jsx)("div",{className:"lg:col-span-3",children:(0,a.jsx)(i,{companies:s,reviewData:e,onUpdateReview:(s,a)=>{let l=e.review_state.map(e=>e.company_id===s?{...a,company_id:s}:e);e.review_state.find(e=>e.company_id===s)||l.push({...a,company_id:s});let r={...e,review_state:l};t(r),(0,m.P)(r).then(e=>{e.valid?(localStorage.setItem("review_state_v1",JSON.stringify(r)),p([])):(p(e.errors||[]),console.error("Validation errors on update:",e.errors))})}})})]})})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xl",children:"データがありません"})})}},6137:(e,t,s)=>{Promise.resolve().then(s.bind(s,2951))},6349:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(5155);function l(e){let{errors:t}=e;if(!t||0===t.length)return null;let s=t.slice(0,5);return(0,a.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-red-800",children:["スキーマ検証エラー (",t.length,"件)"]}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,a.jsxs)("ul",{className:"list-disc pl-5 space-y-1",children:[s.map((e,t)=>(0,a.jsxs)("li",{children:[e.instancePath||"ルート",": ",e.message]},t)),t.length>5&&(0,a.jsxs)("li",{className:"italic",children:["他 ",t.length-5," 件のエラー（詳細はコンソールを確認）"]})]})})]})]})})}}},e=>{e.O(0,[276,441,964,358],()=>e(e.s=6137)),_N_E=e.O()}]);