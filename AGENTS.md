# Repository Guidelines

このリポジトリは設計および要件ドキュメントを管理します。変更は小さく、範囲を明確にし、必要に応じて事前に issue を作成してください。

## プロジェクト構成とモジュール整理
- ルート: トップレベル文書（`README.md`, `AGENTS.md`）。
- `docs/`: ドキュメント一式。
  - `docs/requirements.md`: 課題・スコープ。
  - `docs/design.md`: 高レベル設計とトレードオフ。
  - `docs/technical_design.md`: 詳細フロー・インターフェース・決定事項。
- 新規文書は `docs/` 配下に、目的が分かる kebab-case 名で追加（例: `docs/api-contracts.md`）。

## ビルド・テスト・開発コマンド
本リポジトリにはビルドや実行は不要です。Markdown を編集し、エディタでプレビューしてください。
- 任意: ローカルで Markdown リント（例: `markdownlint **/*.md`）。現時点で CI 要件はありません。

## コーディングスタイル・命名規則
- ファイル: `kebab-case.md` を推奨（例: `data-model.md`）。
- 見出し: 本文はセンテンスケースを推奨。階層は `#` → `##` → `###` を厳守。
- 箇条書き/コード: 簡潔な箇条書き、フェンスコードは言語タグ付き。
- リンク: リポジトリ内は相対リンク（例: `[Design](docs/design.md)`）。
- トーン: 明瞭・客観・意思決定を明示。判断理由と代替案を短く併記。

## テスト方針
自動テストはありません。将来コード資産を追加する場合は次を徹底:
- テストは `tests/` に配置し、ソース構成をミラー。
- 採用フレームワークと実行コマンドを本節に追記。

## コミットとプルリクエスト
- コミット: 1 変更 1 コミット。命令形で短く（例: "Add API section"）。関連 issue を参照（例: `#123`）。
- PR: 目的/範囲、影響ファイル（パス）、主要な決定点、レンダリング確認チェックリスト、必要に応じてスクリーンショット/図を含める。

## アーキテクチャと決定記録
- 重要な決定は `docs/technical_design.md` に日付と背景を記録。大きなテーマは専用文書を作成し、設計文書からリンク。

## セキュリティと機密情報
- 秘密情報・トークン・非公開エンドポイントをコミットしない。伏字とプレースホルダーを明示。

## エージェント/貢献者向け
- 段階的な PR を優先し、大規模な横断編集は避ける。
- タイトル、リンク、例は読者が再現できる形で維持。
- エージェント実行とコミット: 単一のプロンプトに対するエージェントの実装/対応は、作業完了時に必ずコミットで締める（可能なら「1 プロンプト = 1 コミット」）。コミットメッセージは命令形で要約し、関連 issue を参照。

```sh
git add -A
git commit -m "docs: エージェント対応: ◯◯を更新 (#123)"
```

## 役割分担（Codex と Claude）
- Codex（本エージェント）: PDM/仕様策定・表現定義・進行管理を担当。
  - タスク分割と `tasks-cli.md` の維持、インターフェース定義、命名規則、PR 説明作成、レビュー観点の提示。
  - 実装ソース生成は行わない。プロンプト案の提示はユーザーからの明示依頼がある場合のみ最小限で行う（Codex側から提案・勧誘はしない）。
- Claude: 実装・ビルド・テスト・最適化を担当。
  - `docs/` とタスク定義に基づき、TypeScript 実装、単体テスト、動作確認を遂行。
- ユーザー（仲介）: 必要に応じてプロンプト案の作成/修正/承認を行い、Claude に依頼する。Codexは Claude に直接指示やコマンド実行を行わない。

## ヒューマン・イン・ザ・ループ運用
- 起票: タスク/仕様は Codex が `tasks-cli.md` 等を更新して提示。プロンプト案はユーザーが明示依頼した場合のみ作成。
- レビュー: ユーザーが内容を確認・修正・承認。承認なしで Claude への依頼は行わない。
- 依頼/実装: ユーザーが Claude に依頼し、Claude が実装・テストを実施。
- 反映/記録: ユーザーが結果を取り込み、Codex はドキュメント/タスクを更新して「1プロンプト=1コミット」で履歴化。
- 禁止事項: Codex は Claude への直接メッセージ送信・コマンド実行・API呼出を行わない。機密をプロンプトに含めない。ユーザー承認前に大規模変更を行わない。「プロンプト案を用意しますか？」等の提案・勧誘を行わない。

## 検索タスクにおける Gemini 利用
- 目的: 公式サイトや一次情報の候補URLを素早く列挙し、`data/urls.csv` に追加するために利用。
- 前提: ネットワークアクセスが必要なため、実行時は承認（昇格）を取得する。
- 使い方（例）:
  ```bash
  gemini -p "以下の企業について、従業員数が記載される可能性が高い日本語の公式/一次情報のURL候補を列挙してください。各社2〜5件。出力はCSV形式のみで、ヘッダは company_id,url,source_type,priority。優先度は official/company-profile/IR=1、公式PDF=2〜3、Wikipedia=5、ニュース=7、まとめ=9。

  company_id=1, 企業名: sincereed株式会社, ドメイン: sincereed.com
  company_id=2, 企業名: マミヤITソリューションズ株式会社, ドメイン: mamiya-its.co.jp" 
  ```
- 反映手順: 提案結果をガイドライン（`docs/manual/source_guidelines.md`）に沿って正規化し、低信頼や存在しないURL（例: 存在しないWikipedia項目）は除去した上で `data/urls.csv` に追記。変更は「1プロンプト=1コミット」で記録。
