(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[208],{1089:(e,s,l)=>{"use strict";l.d(s,{P:()=>x});var a=l(9915),r=l.n(a),t=l(1527),n=l.n(t);let c=null,i=null,o=null,d=async()=>{if(!i)return o||(o=(async()=>{c=new(r())({allErrors:!0,strict:!1}),n()(c);try{let e=await fetch("/schemas/review.schema.json");if(!e.ok)throw Error("Failed to fetch schema: ".concat(e.status));let s=await e.json();i=c.compile(s)}catch(e){throw console.error("Failed to load schema:",e),Error("スキーマの読み込みに失敗しました")}})())},x=async e=>{if(await d(),!i)throw Error("バリデータが初期化されていません");let s=i(e);return{valid:s,errors:s?void 0:i.errors||[]}}},5219:(e,s,l)=>{Promise.resolve().then(l.bind(l,6903))},6349:(e,s,l)=>{"use strict";l.d(s,{A:()=>r});var a=l(5155);function r(e){let{errors:s}=e;if(!s||0===s.length)return null;let l=s.slice(0,5);return(0,a.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-red-800",children:["スキーマ検証エラー (",s.length,"件)"]}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,a.jsxs)("ul",{className:"list-disc pl-5 space-y-1",children:[l.map((e,s)=>(0,a.jsxs)("li",{children:[e.instancePath||"ルート",": ",e.message]},s)),s.length>5&&(0,a.jsxs)("li",{className:"italic",children:["他 ",s.length-5," 件のエラー（詳細はコンソールを確認）"]})]})})]})]})})}},6903:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>d});var a=l(5155),r=l(2115),t=l(8999),n=l(6874),c=l.n(n),i=l(6349),o=l(1089);function d(){let e=(0,t.useParams)(),s=(0,t.useRouter)(),l=parseInt(e.id),[n,d]=(0,r.useState)(null),[x,m]=(0,r.useState)(null),[h,u]=(0,r.useState)({company_id:l,decision:"unknown"}),[v,g]=(0,r.useState)(!0),[p,j]=(0,r.useState)([]);(0,r.useEffect)(()=>{f()},[l]);let f=async()=>{try{let e=await fetch("/review.json"),a=await e.json(),r=await (0,o.P)(a);if(!r.valid){j(r.errors||[]),console.error("Schema validation errors:",r.errors),g(!1);return}j([]),d(a);let t=a.companies.find(e=>e.id===l);if(!t)return void s.push("/");let n=a.evidence.filter(e=>e.company_id===l),c=a.review_state.find(e=>e.company_id===l),i=n.filter(e=>null!==e.value).sort((e,s)=>(s.score||0)-(e.score||0))[0];m({...t,evidences:n,reviewState:c,bestEvidence:i}),c&&u(c)}catch(e){console.error("Error loading company data:",e)}finally{g(!1)}},b=async()=>{if(!n||!x)return;let e={...h,decided_at:new Date().toISOString()},s=n.review_state.filter(e=>e.company_id!==l);s.push(e);let a={...n,review_state:s},r=await (0,o.P)(a);if(!r.valid){j(r.errors||[]),console.error("Schema validation errors before save:",r.errors);return}j([]);try{localStorage.setItem("review_state_v1",JSON.stringify(a)),console.log("Data saved to localStorage")}catch(e){console.error("Failed to save to localStorage:",e)}let t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),c=URL.createObjectURL(t),i=document.createElement("a");i.href=c,i.download="review_".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c)};return v?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"読み込み中..."}):x?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[p.length>0&&(0,a.jsx)(i.A,{errors:p}),(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(c(),{href:"/",className:"text-blue-500 hover:text-blue-600",children:"← 一覧に戻る"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:x.name})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold",children:["証跡一覧 (",x.evidences.length,"件)"]}),x.evidences.map((e,s)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[e.value?(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[e.value,"人"]}):(0,a.jsx)("p",{className:"text-lg text-gray-500",children:"抽出失敗"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["信頼度: ",(100*(e.score||0)).toFixed(0),"% / 方法: ",e.model||"none"]})]}),e.status_code&&(0,a.jsxs)("span",{className:"px-2 py-1 text-xs rounded ".concat(200===e.status_code?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["HTTP ",e.status_code]})]}),e.raw_text&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e.raw_text})}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsxs)("p",{children:["URL: ",(0,a.jsx)("a",{href:e.source_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:e.source_url})]}),e.page_title&&(0,a.jsxs)("p",{children:["タイトル: ",e.page_title]}),(0,a.jsxs)("p",{children:["取得日時: ",new Date(e.extracted_at).toLocaleString("ja-JP")]})]})]},s))]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 sticky top-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"レビュー判定"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"判定"}),(0,a.jsx)("div",{className:"space-y-2",children:[{value:"ok",label:"OK",color:"green"},{value:"ng",label:"NG",color:"red"},{value:"unknown",label:"不明",color:"gray"}].map(e=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",value:e.value,checked:h.decision===e.value,onChange:e=>u({...h,decision:e.target.value}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-".concat(e.color,"-600"),children:e.label})]},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"上書き値（任意）"}),(0,a.jsx)("input",{type:"number",value:h.override_value||"",onChange:e=>u({...h,override_value:e.target.value?parseInt(e.target.value):null}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例: 1000"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メモ（任意）"}),(0,a.jsx)("textarea",{value:h.note||"",onChange:e=>u({...h,note:e.target.value||null}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"メモを入力..."})]}),(0,a.jsx)("button",{onClick:b,className:"w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"保存"})]})]})})]})})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"企業が見つかりません"})}}},e=>{e.O(0,[276,441,964,358],()=>e(e.s=5219)),_N_E=e.O()}]);